name: Release Web App

on:
  push:
    tags:
      - 'web@*.*.*'

concurrency:
  group: web-release-${{ github.ref }}
  cancel-in-progress: true

env:
  APP_NAME: web
  VERSION: ${{ github.ref_name }}
  NODE_VERSION: '22.x'

jobs:
  test:
    name: Run Tests
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Run Test Suite
        run: |
          echo "ðŸ§ª Starting tests for ${{ env.APP_NAME }}@${{ env.VERSION }}..."
          echo "  âœ“ Running ESLint checks..."
          sleep 1
          echo "  âœ“ Running TypeScript type checking..."
          sleep 1
          echo "  âœ“ Executing test suite..."
          sleep 3
          echo "  â±ï¸  Tests completed in 5s"
          echo "âœ… All tests passed for ${{ env.APP_NAME }}@${{ env.VERSION }}"

      - name: Update Summary
        run: |
          echo "### ðŸ§ª Test Results" >> $GITHUB_STEP_SUMMARY
          echo "**App**: ${{ env.APP_NAME }}" >> $GITHUB_STEP_SUMMARY
          echo "**Version**: ${{ env.VERSION }}" >> $GITHUB_STEP_SUMMARY
          echo "**Status**: âœ… Passed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

  build:
    name: Build Application
    runs-on: ubuntu-latest
    needs: test
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Build Application
        run: |
          echo "ðŸ—ï¸  Starting build for ${{ env.APP_NAME }}@${{ env.VERSION }}..."
          echo "  â³ Compiling Next.js application..."
          sleep 2
          echo "  â³ Optimizing assets..."
          sleep 1
          echo "  â³ Generating static pages..."
          sleep 2
          echo "  â±ï¸  Build completed in 5s"
          echo "âœ… Build successful for ${{ env.APP_NAME }}@${{ env.VERSION }}"

      - name: Update Summary
        run: |
          echo "### ðŸ—ï¸ Build Results" >> $GITHUB_STEP_SUMMARY
          echo "**App**: ${{ env.APP_NAME }}" >> $GITHUB_STEP_SUMMARY
          echo "**Version**: ${{ env.VERSION }}" >> $GITHUB_STEP_SUMMARY
          echo "**Status**: âœ… Success" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

  deploy:
    name: Deploy to Production
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Deploy Application
        run: |
          echo "ðŸš€ Starting deployment for ${{ env.APP_NAME }}@${{ env.VERSION }}..."
          echo "  â³ Preparing deployment environment..."
          sleep 2
          echo "  â³ Uploading build artifacts..."
          sleep 1
          echo "  â³ Configuring CDN and routing..."
          sleep 2
          echo "  â±ï¸  Deployment completed in 5s"
          echo "âœ… Successfully deployed ${{ env.APP_NAME }}@${{ env.VERSION }}"

      - name: Update Summary
        run: |
          echo "### ðŸš€ Deployment Results" >> $GITHUB_STEP_SUMMARY
          echo "**App**: ${{ env.APP_NAME }}" >> $GITHUB_STEP_SUMMARY
          echo "**Version**: ${{ env.VERSION }}" >> $GITHUB_STEP_SUMMARY
          echo "**Status**: âœ… Deployed" >> $GITHUB_STEP_SUMMARY
          echo "**Tag**: \`${{ github.ref_name }}\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "### âœ¨ Release Complete" >> $GITHUB_STEP_SUMMARY
          echo "All stages completed successfully for ${{ env.APP_NAME }}@${{ env.VERSION }}" >> $GITHUB_STEP_SUMMARY
